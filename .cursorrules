# Cursor Rules for Dating App Development

> **‚ö†Ô∏è DEPRECATED:** This file is legacy. Rules have been migrated to `.cursor/rules/` following Cursor best practices.
> 
> **Active rules are now in:**
> - `.cursor/rules/ui-components/` - UI component standards
> - `.cursor/rules/android-abstractions/` - Android migration abstractions
> - `.cursor/rules/mobile-builds/` - Mobile app build requirements
> - `.cursor/rules/build-numbers/` - Build number visibility and summaries
> 
> This file is kept for reference but will not be actively used by Cursor.

## üö´ CRITICAL RULES - NEVER VIOLATE

### 1. NO WINDOW MODALS - Use React Components Only

**FORBIDDEN:**
- `window.alert()` - NEVER use
- `window.confirm()` - NEVER use  
- `window.prompt()` - NEVER use

**REQUIRED:**
- Use `<AlertDialog>` component from `@/components/AlertDialog` for alerts
- Use `<ConfirmDialog>` component from `@/components/ConfirmDialog` for confirmations
- All user-facing dialogs must be React components

**Example:**
```tsx
// ‚ùå FORBIDDEN
if (confirm('Are you sure?')) { ... }
alert('Error occurred');

// ‚úÖ REQUIRED
import AlertDialog from '@/components/AlertDialog';
import ConfirmDialog from '@/components/ConfirmDialog';

<ConfirmDialog
  open={showConfirm}
  onConfirm={handleConfirm}
  onCancel={() => setShowConfirm(false)}
  title="Are you sure?"
  message="This action cannot be undone."
  loading={processing}
/>

<AlertDialog
  open={showAlert}
  onClose={() => setShowAlert(false)}
  title="Error"
  message="An error occurred."
/>
```

### 2. ACTION BUTTONS - Always Show Loading State

**REQUIREMENTS:**
- Every action button MUST have a `loading` state
- When `loading` is true:
  - The button MUST be `disabled={loading}`
  - A loading spinner MUST be visible
  - Loading text (e.g., "Uploading...", "Processing...") SHOULD be shown
  - ALL other action buttons in the same form/page MUST also be disabled
  - Cancel buttons in forms/dialogs MUST be disabled when `loading` is true

**Pattern:**
```tsx
const [loading, setLoading] = useState(false);

const handleAction = async () => {
  setLoading(true);
  try {
    await performAction();
  } catch (error) {
    // Handle error
  } finally {
    setLoading(false);
  }
};

// ‚úÖ REQUIRED
<button
  onClick={handleAction}
  disabled={loading}
  className="..."
>
  {loading ? (
    <>
      <svg className="animate-spin h-4 w-4 inline-block mr-2" ...>
        {/* spinner */}
      </svg>
      Processing...
    </>
  ) : (
    'Submit'
  )}
</button>

// In forms, disable ALL buttons:
<button type="submit" disabled={loading}>Save</button>
<button type="button" disabled={loading}>Cancel</button>
```

**For ConfirmDialog:**
```tsx
<ConfirmDialog
  open={showConfirm}
  onConfirm={handleConfirm}
  onCancel={() => setShowConfirm(false)}
  loading={deleting}  // ‚úÖ REQUIRED
  loadingLabel="Deleting..."  // ‚úÖ REQUIRED
/>
```

### 3. ANDROID MIGRATION PREPARATION - Use Abstractions

**REQUIRED:** All new code MUST use abstraction layers from Android migration preparation:

#### Navigation - NEVER use Next.js router directly
```tsx
// ‚ùå FORBIDDEN
import { useRouter } from 'next/navigation';
const router = useRouter();
router.push('/path');
router.replace('/path');
router.back();

// ‚úÖ REQUIRED
import { useNavigation } from '@/lib/navigation';
const navigation = useNavigation();
navigation.push('/path');
navigation.replace('/path');
navigation.goBack();
```

#### Links - Use NavigationLink
```tsx
// ‚ùå FORBIDDEN
import Link from 'next/link';
<Link href="/path">Link</Link>

// ‚úÖ REQUIRED
import { NavigationLink } from '@/lib/navigation';
<NavigationLink href="/path">Link</NavigationLink>
```

#### Environment - NEVER use window.location directly
```tsx
// ‚ùå FORBIDDEN
window.location.href = '/path';
window.location.reload();
window.location.origin;
window.location.search;
window.location.hash;

// ‚úÖ REQUIRED
import { environment } from '@/lib/environment';
environment.redirect('/path');
environment.reload();
environment.getOrigin();
environment.getQueryParams();
environment.getHashParams();
```

#### Image Picker - Use abstraction
```tsx
// ‚ùå FORBIDDEN
<input type="file" accept="image/*" />
const fileInputRef = useRef<HTMLInputElement>(null);
fileInputRef.current?.click();

// ‚úÖ REQUIRED
import { ImagePicker, ImagePickerRef } from '@/components/ImagePicker';
const imagePickerRef = useRef<ImagePickerRef>(null);
<ImagePicker
  ref={imagePickerRef}
  onSelect={handleFileSelect}
  accept="image/*"
  disabled={loading}
/>
<button onClick={() => imagePickerRef.current?.open()}>
  Select Photo
</button>
```

#### File Utils - Use abstraction
```tsx
// ‚ùå FORBIDDEN
const reader = new FileReader();
reader.readAsDataURL(file);

// ‚úÖ REQUIRED
import { fileUtils } from '@/lib/file-utils';
const base64 = await fileUtils.fileToBase64(file);
const blob = await fileUtils.fileToBlob(file);
```

#### Pathname - Use navigation abstraction
```tsx
// ‚ùå FORBIDDEN
import { usePathname } from 'next/navigation';
const pathname = usePathname();

// ‚úÖ REQUIRED
import { useNavigation } from '@/lib/navigation';
const navigation = useNavigation();
const pathname = navigation.getCurrentPath();
```

#### Search Params - Use navigation abstraction
```tsx
// ‚ùå FORBIDDEN
import { useSearchParams } from 'next/navigation';
const searchParams = useSearchParams();
const value = searchParams.get('key');

// ‚úÖ REQUIRED
import { useNavigation } from '@/lib/navigation';
const navigation = useNavigation();
const params = navigation.getParams();
const value = params.key;
```

### 4. MOBILE APP BUILD REQUIREMENTS

**CRITICAL:** The mobile app is built as a standalone release APK with no development dependencies.

#### Build Configuration
- **ONLY use release builds:** `npm run build:apk:release` in `apps/mobile/`
- **NO USB debugging:** Mobile device is NOT connected via USB cable - builds must be transferable as standalone APK files
- **NO Metro bundler connection:** JavaScript code MUST be bundled into the APK during build - the app runs independently without requiring a Metro bundler connection to the development PC
- **Standalone operation:** The built APK must function completely independently - no network connection to development machine required

#### Build Process Requirements
- Build scripts MUST generate a unique build number for each release build
- Build number MUST be written to `apps/mobile/src/lib/build-info.ts` during the build process
- Build number MUST be displayed in the app's dashboard screen (see `apps/mobile/src/screens/main/DashboardScreen.tsx`)
- Build number MUST be prominently displayed in the terminal output after successful build completion

#### Build Number Display Format
**In Terminal (after build):**
```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  üî¢ BUILD NUMBER (check in app dashboard):
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  [BUILD_NUMBER]
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
```

**In App Dashboard:**
- Build number MUST be visible in the dashboard UI (bottom right corner or similar location)
- Import from `apps/mobile/src/lib/build-info.ts`: `import { BUILD_NUMBER } from '../../lib/build-info';`
- Display format: `{BUILD_NUMBER}` (e.g., "191016")

#### Build Script Requirements
- Build scripts (`apps/mobile/scripts/build-apk-release.js`) MUST:
  1. Generate a unique 6-digit build number
  2. Write the build number to `apps/mobile/src/lib/build-info.ts` before bundling
  3. Display the build number prominently in terminal output after successful build
  4. Include build number in the build results summary section

## üìã CODE REVIEW CHECKLIST

Before submitting code, verify:

- [ ] No `window.alert()`, `window.confirm()`, or `window.prompt()` calls
- [ ] All action buttons have `loading` state and show spinner when loading
- [ ] All buttons in forms/dialogs are disabled when `loading` is true
- [ ] No direct `useRouter` from `next/navigation` - use `useNavigation` instead
- [ ] No direct `Link` from `next/link` - use `NavigationLink` instead
- [ ] No direct `window.location` usage - use `environment` helper instead
- [ ] No direct `usePathname` or `useSearchParams` - use `navigation.getCurrentPath()` and `navigation.getParams()` instead
- [ ] No direct HTML file inputs - use `ImagePicker` component instead
- [ ] No direct `FileReader` usage - use `fileUtils` instead
- [ ] Mobile builds use `npm run build:apk:release` only (no debug builds)
- [ ] Mobile build scripts generate and display build numbers correctly

## üéØ EXAMPLES OF CORRECT PATTERNS

### Form with Loading State
```tsx
'use client';

import { useState } from 'react';
import { useNavigation } from '@/lib/navigation';
import ConfirmDialog from '@/components/ConfirmDialog';

export default function MyForm() {
  const navigation = useNavigation();
  const [loading, setLoading] = useState(false);
  const [showConfirm, setShowConfirm] = useState(false);

  const handleSubmit = async () => {
    setLoading(true);
    try {
      await submitData();
      navigation.push('/success');
    } catch (error) {
      // Show AlertDialog, not alert()
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      <form>
        <button
          type="submit"
          onClick={handleSubmit}
          disabled={loading}
        >
          {loading ? (
            <>
              <Spinner />
              Saving...
            </>
          ) : (
            'Save'
          )}
        </button>
        <button
          type="button"
          onClick={() => setShowConfirm(true)}
          disabled={loading}
        >
          Delete
        </button>
        <button
          type="button"
          onClick={() => navigation.goBack()}
          disabled={loading}
        >
          Cancel
        </button>
      </form>

      <ConfirmDialog
        open={showConfirm}
        onConfirm={handleDelete}
        onCancel={() => setShowConfirm(false)}
        loading={loading}
        loadingLabel="Deleting..."
      />
    </>
  );
}
```

### Navigation Example
```tsx
'use client';

import { useNavigation } from '@/lib/navigation';
import { NavigationLink } from '@/lib/navigation';

export default function MyPage() {
  const navigation = useNavigation();
  const params = navigation.getParams();
  const currentPath = navigation.getCurrentPath();

  return (
    <div>
      <NavigationLink href="/dashboard">Dashboard</NavigationLink>
      <button onClick={() => navigation.push('/partners', { id: '123' })}>
        View Partner
      </button>
      <button onClick={() => navigation.goBack()}>
        Back
      </button>
    </div>
  );
}
```

## üîç COMMON MISTAKES TO AVOID

1. **Using `router.refresh()`** - Use `environment.reload()` instead
2. **Forgetting to disable Cancel buttons** - They must be disabled when `loading` is true
3. **Not showing loading spinner** - Always show visual feedback
4. **Using `window.location.href`** - Use `environment.redirect()` instead
5. **Direct Next.js imports** - Always use abstraction layers
6. **Suggesting USB debugging for mobile** - Mobile device is NOT connected via USB
7. **Suggesting Metro bundler for mobile** - Mobile app must be standalone with bundled JS
8. **Forgetting build numbers** - Every release build MUST have a visible build number

## üìö REFERENCE DOCUMENTATION

- Android Migration Preparation: `PREPARATION_FOR_ANDROID.md`
- Android Migration Guide: `ANDROID_MIGRATION_GUIDE.md`
- Navigation Abstraction: `apps/web/src/lib/navigation/`
- Environment Helper: `apps/web/src/lib/environment/`
- Image Picker: `apps/web/src/components/ImagePicker/`
- File Utils: `apps/web/src/lib/file-utils/`
- Mobile Build Scripts: `apps/mobile/scripts/build-apk-release.js`
- Mobile Build Info: `apps/mobile/src/lib/build-info.ts`
- Mobile Dashboard: `apps/mobile/src/screens/main/DashboardScreen.tsx`

## ‚ö†Ô∏è ENFORCEMENT

These rules are CRITICAL for:
1. Maintaining consistent UX (no browser modals)
2. Preventing duplicate submissions (loading states)
3. Ensuring Android migration compatibility (abstractions)
4. Ensuring mobile builds are standalone and properly versioned

Any code that violates these rules MUST be rejected and fixed before merging.

## üìù SUMMARY AND COMMUNICATION RULES

### Build Number and Version Publishing Summary Format

**REQUIRED:** When a version is published (code is committed and pushed, or a build is deployed), the summary MUST include build information prominently.

#### Web App Build Summary Format

**REQUIRED:** When a web app version is published (committed and pushed, or deployed to Vercel), the first line of the summary MUST include:

**Format:**
- Build status (success/failure)
- Build number (from `BUILD_NUMBER` in `apps/web/src/lib/version.ts`)
- Build timestamp or commit hash if available
- Deployment platform (Vercel, local, etc.) if applicable

**Example:**
```
‚úÖ Build successful - Build #abc1234 - Published to Vercel at 12:45:23 UTC (commit: abc1234)
[Rest of summary...]
```

**OR:**

```
‚ùå Build failed - Build #dev - Vercel deployment error at 12:45:23 UTC
[Error details and rest of summary...]
```

#### Mobile App Build Summary Format

**REQUIRED:** When a mobile app release build completes (`npm run build:apk:release`), the summary MUST include:

**Format:**
- Build status (success/failure)
- Build number (the 6-digit number generated during build)
- APK file location
- Build number MUST be displayed in a clearly marked section

**Example:**
```
‚úÖ Mobile Release Build successful - Build #191016
üì¶ APK: android\app\build\outputs\apk\release\app-release.apk
üî¢ Build Number: 191016 (visible in app dashboard)
[Rest of summary...]
```

**Terminal Output Requirements:**
- Build scripts MUST display build number in a clearly marked section after successful build
- Format should match the example shown in terminal output (lines 1001-1004 in build script output)
- Build number MUST be displayed both inline with build results AND in a dedicated section

#### Build Number Visibility Requirements

**Web App:**
- Build number MUST be visible in the web app UI (via `VersionFooter` component showing `v{APP_VERSION} (build {BUILD_NUMBER})`)
- Build number is sourced from `apps/web/src/lib/version.ts`

**Mobile App:**
- Build number MUST be visible in the mobile app dashboard (bottom right corner or similar)
- Build number is sourced from `apps/mobile/src/lib/build-info.ts`
- Build number is generated during build process and written to `build-info.ts` before bundling

This ensures immediate visibility of build status and build numbers in conversation summaries and in the applications themselves.